Rule,Description,Cypher Query (Support)
Unique `id` per node,Each node should have a unique `id` property.,"MATCH (n) WITH n.neo4jImportId AS id, COUNT(n) AS countNodes WHERE id IS NOT NULL AND countNodes = 1 RETURN COUNT(id) AS support"
Consistent labeling,"Each node should have a label that is one of the allowed labels: `User`, `Group`, `Domain`, `OU`, `GPO`, or `Computer`.",MATCH (n) WHERE (n:User OR n:Group OR n:Domain OR n:OU OR n:GPO OR n:Computer) RETURN COUNT(n) AS support
MEMBER_OF relationships have correct direction,MEMBER_OF relationships should always point from a `User` or `Group` node to a `Group` node.,MATCH (u:User)-[r:MEMBER_OF]->(g:Group) RETURN COUNT(r) AS support
ADMIN_TO relationships have correct direction,ADMIN_TO relationships should always point from a `User` or `Group` node to a `Computer` node.,MATCH (g:Group)-[r:ADMIN_TO]->(c:Computer) RETURN COUNT(r) AS support
HAS_SESSION relationships have correct direction,HAS_SESSION relationships should always point from a `User` node to a `Computer` node.,MATCH (c:Computer)-[r:HAS_SESSION]->(u:User) RETURN COUNT(r) AS support
CAN_RDP relationships have correct direction,CAN_RDP relationships should always point from a `User` node to a `Computer` node.,MATCH (u:User)-[r:CAN_RDP]->(c:Computer) RETURN COUNT(r) AS support
ALLOWED_TO_DELEGATE relationships have correct direction,ALLOWED_TO_DELEGATE relationships should always point from a `User` node to a `Computer` node.,MATCH (u:User)-[r:ALLOWED_TO_DELEGATE]->(c:Computer) RETURN COUNT(r) AS support
Each node can have only one GENERIC_ALL node,A node can be connected to the GENERIC_ALL node only once.,"MATCH (n)-[:GENERIC_ALL]->(m) WITH n, COUNT(m) AS count WHERE count = 1 RETURN COUNT(DISTINCT n) AS support"
MEMBER_OF nodes should not have multiple outgoing relationships,A MEMBER_OF node should not have more than one outgoing relationship.,"MATCH (n)-[:MEMBER_OF]->() WITH n, COUNT(*) AS outgoingCount WHERE outgoingCount <= 1 RETURN COUNT(DISTINCT n) AS support"
Nodes connected to GENERIC_ALL should not have any other relationships,A node that is connected to the GENERIC_ALL node should not have any other relationships.,MATCH (n)-[:GENERIC_ALL]->() WHERE size((n)--()) = 1 RETURN COUNT(DISTINCT n) AS support
"Nodes with ADMIN_TO, ALLOWED_TO_DELEGATE, EXECUTE_DCOM, CAN_RDP, HAS_SESSION labels should not connect to GENERIC_ALL",Nodes with specific labels should not connect to the GENERIC_ALL node.,"MATCH (n) WHERE n:ADMIN_TO OR n:ALLOWED_TO_DELEGATE OR n:EXECUTE_DCOM OR n:CAN_RDP OR n:HAS_SESSION WITH COUNT(DISTINCT n) AS totalFacts MATCH (n) WHERE (n:ADMIN_TO OR n:ALLOWED_TO_DELEGATE OR n:EXECUTE_DCOM OR n:CAN_RDP OR n:HAS_SESSION) AND NOT (n)-[:GENERIC_ALL]->() WITH COUNT(DISTINCT n) AS validFacts, totalFacts RETURN toFloat(validFacts) / totalFacts AS coverage"
Nodes with CONTAINS label should not have incoming relationships,A node with the CONTAINS label should not have any incoming relationships.,MATCH (n:CONTAINS) WHERE NOT ()-[]->(n) RETURN COUNT(DISTINCT n) AS support
Nodes with MEMBER_OF label should not have incoming relationships,A node with the MEMBER_OF label should not have any incoming relationships.,MATCH (n:MEMBER_OF) WHERE NOT ()-[]->(n) RETURN COUNT(DISTINCT n) AS support
